# SAM3 æ ‡æ³¨å·¥å…·å®Œæ•´ä½¿ç”¨æŒ‡å—

## æ–‡ä»¶è¯´æ˜

- **`batch_annotate_sam3.py`** - æ‰¹é‡æ ‡æ³¨å·¥å…·ï¼ˆå‘½ä»¤è¡Œ + Python APIï¼‰
- **`annotator_config.yaml`** - æ ‡æ³¨å·¥å…·é…ç½®æ–‡ä»¶
- **`sam3_labelme.py`** - GUI æ ‡æ³¨å·¥å…·ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

## ç›®å½•
1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [GUI æ ‡æ³¨å·¥å…·](#gui-æ ‡æ³¨å·¥å…·)
3. [æ‰¹é‡æ ‡æ³¨è„šæœ¬](#æ‰¹é‡æ ‡æ³¨è„šæœ¬)
4. [æ ‡æ³¨æ ¼å¼è¯´æ˜](#æ ‡æ³¨æ ¼å¼è¯´æ˜)
5. [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…ä¸»é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# å®‰è£…æ ‡æ³¨å·¥å…·é¢å¤–ä¾èµ–
pip install PyQt5 scikit-image
```

### 2. å‡†å¤‡æ¨¡å‹

ç¡®ä¿ä½ æœ‰ SAM3 æ¨¡å‹æ–‡ä»¶ï¼Œæ¨èè·¯å¾„ï¼š
```
experiments/checkpoints/model_fp16.pt
```

### 3. å¯åŠ¨æ ‡æ³¨å·¥å…·

**Windows:**
```bash
start_annotator.bat
```

**Linux/Mac:**
```bash
bash start_annotator.sh
```

æˆ–ç›´æ¥è¿è¡Œï¼š
```bash
python sam3_annotator.py
```

---

## GUI æ ‡æ³¨å·¥å…·

### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAM3 Annotation Tool                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                              â”‚                â”‚
â”‚ æ¨¡å‹è®¾ç½® â”‚                              â”‚   æ ‡æ³¨åˆ—è¡¨     â”‚
â”‚          â”‚                              â”‚                â”‚
â”‚ å›¾åƒæ“ä½œ â”‚        ç”»å¸ƒåŒºåŸŸ              â”‚   [æ ‡æ³¨1]      â”‚
â”‚          â”‚                              â”‚   [æ ‡æ³¨2]      â”‚
â”‚ æ ‡æ³¨æ¨¡å¼ â”‚      (æ˜¾ç¤ºå›¾åƒå’Œæ ‡æ³¨)        â”‚   [æ ‡æ³¨3]      â”‚
â”‚          â”‚                              â”‚                â”‚
â”‚ æ ‡æ³¨å‚æ•° â”‚                              â”‚   [åˆ é™¤]       â”‚
â”‚          â”‚                              â”‚   [æ¸…ç©º]       â”‚
â”‚          â”‚                              â”‚   [ä¿å­˜JSON]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµç¨‹

#### ç¬¬ä¸€æ­¥ï¼šåŠ è½½æ¨¡å‹

1. ç‚¹å‡» **"æµè§ˆæ¨¡å‹"** æŒ‰é’®
2. é€‰æ‹©æ¨¡å‹æ–‡ä»¶ï¼ˆå¦‚ `experiments/checkpoints/model_fp16.pt`ï¼‰
3. ç‚¹å‡» **"åŠ è½½æ¨¡å‹"** æŒ‰é’®
4. ç­‰å¾…çŠ¶æ€å˜ä¸ºç»¿è‰² **"æ¨¡å‹: å·²åŠ è½½"**

#### ç¬¬äºŒæ­¥ï¼šåŠ è½½å›¾åƒ

1. ç‚¹å‡» **"åŠ è½½å›¾åƒ"** æŒ‰é’®
2. é€‰æ‹©è¦æ ‡æ³¨çš„å›¾åƒæ–‡ä»¶
3. å›¾åƒå°†æ˜¾ç¤ºåœ¨ä¸­å¤®ç”»å¸ƒåŒºåŸŸ

#### ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©æ ‡æ³¨æ¨¡å¼

##### æ¨¡å¼ Aï¼šæ–‡æœ¬æç¤ºï¼ˆæ¨èç”¨äºæ‰¹é‡æ ‡æ³¨ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦æ£€æµ‹å›¾åƒä¸­æ‰€æœ‰æŸç±»ç›®æ ‡

**æ“ä½œæ­¥éª¤ï¼š**
1. é€‰æ‹© **"æ–‡æœ¬æç¤º"** æ¨¡å¼
2. åœ¨ **"æ–‡æœ¬æç¤º"** è¾“å…¥æ¡†è¾“å…¥ç±»åˆ«ï¼Œä¾‹å¦‚ï¼š
   - `car` - æ£€æµ‹æ‰€æœ‰æ±½è½¦
   - `person` - æ£€æµ‹æ‰€æœ‰äºº
   - `dog` - æ£€æµ‹æ‰€æœ‰ç‹—
3. åœ¨ **"å½“å‰æ ‡ç­¾"** è¾“å…¥æ¡†è¾“å…¥æ ‡ç­¾åç§°ï¼ˆå¯ä¸æç¤ºè¯ç›¸åŒï¼‰
4. è°ƒæ•´ **"ç½®ä¿¡åº¦é˜ˆå€¼"**ï¼ˆæ¨è 0.3-0.5ï¼‰
5. ç‚¹å‡» **"è¿è¡Œæ–‡æœ¬æç¤º"**

**ç¤ºä¾‹ï¼š**
```
æ–‡æœ¬æç¤º: car
å½“å‰æ ‡ç­¾: car
ç½®ä¿¡åº¦é˜ˆå€¼: 0.3

ç»“æœ: è‡ªåŠ¨æ£€æµ‹å›¾åƒä¸­æ‰€æœ‰æ±½è½¦
```

##### æ¨¡å¼ Bï¼šç‚¹æç¤ºï¼ˆæ¨èç”¨äºç²¾ç¡®æ ‡æ³¨ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦ç²¾ç¡®æ ‡æ³¨å•ä¸ªå¤æ‚ç›®æ ‡

**æ“ä½œæ­¥éª¤ï¼š**
1. é€‰æ‹© **"ç‚¹æç¤º"** æ¨¡å¼
2. åœ¨å›¾åƒä¸Šæ·»åŠ ç‚¹ï¼š
   - **å·¦é”®ç‚¹å‡»** â†’ å‰æ™¯ç‚¹ï¼ˆç›®æ ‡å†…éƒ¨ï¼‰
   - **å³é”®ç‚¹å‡»** â†’ èƒŒæ™¯ç‚¹ï¼ˆä¸è¦çš„åŒºåŸŸï¼‰
3. é€šå¸¸æ·»åŠ  3-5 ä¸ªç‚¹å³å¯
4. ç‚¹å‡» **"è¿è¡Œç‚¹æç¤º"**
5. ç‚¹å‡» **"æ¸…é™¤ç‚¹"** å¯ä»¥é‡æ–°å¼€å§‹

**ç¤ºä¾‹ï¼š**
```
ä»»åŠ¡: æ ‡æ³¨ä¸€åªè¢«é®æŒ¡çš„çŒ«

æ“ä½œ:
1. å·¦é”®ç‚¹å‡»çŒ«çš„å¤´éƒ¨ï¼ˆå‰æ™¯ï¼‰
2. å·¦é”®ç‚¹å‡»çŒ«çš„èº«ä½“ï¼ˆå‰æ™¯ï¼‰
3. å³é”®ç‚¹å‡»æ—è¾¹çš„ç‹—ï¼ˆèƒŒæ™¯ï¼Œä¸è¦åŒ…å«ï¼‰
4. è¿è¡Œç‚¹æç¤º

ç»“æœ: ç²¾ç¡®åˆ†å‰²å‡ºè¿™åªçŒ«ï¼Œä¸åŒ…å«ç‹—
```

##### æ¨¡å¼ Cï¼šæ¡†æç¤ºï¼ˆæ¨èç”¨äºå¿«é€Ÿæ ‡æ³¨ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** å¿«é€Ÿæ ‡æ³¨è§„åˆ™å½¢çŠ¶çš„ç›®æ ‡

**æ“ä½œæ­¥éª¤ï¼š**
1. é€‰æ‹© **"æ¡†æç¤º"** æ¨¡å¼
2. åœ¨å›¾åƒä¸ŠæŒ‰ä½é¼ æ ‡å·¦é”®æ‹–æ‹½
3. ç»˜åˆ¶åŒ…å«ç›®æ ‡çš„çŸ©å½¢æ¡†
4. é‡Šæ”¾é¼ æ ‡ï¼Œè‡ªåŠ¨ç”Ÿæˆ mask

**ç¤ºä¾‹ï¼š**
```
ä»»åŠ¡: æ ‡æ³¨ä¸€è¾†è½¦

æ“ä½œ:
1. åœ¨è½¦çš„å·¦ä¸Šè§’æŒ‰ä¸‹é¼ æ ‡
2. æ‹–æ‹½åˆ°å³ä¸‹è§’
3. é‡Šæ”¾é¼ æ ‡

ç»“æœ: è‡ªåŠ¨ç²¾ç¡®åˆ†å‰²å‡ºè½¦è¾†
```

#### ç¬¬å››æ­¥ï¼šç¼–è¾‘æ ‡æ³¨

- **ä¿®æ”¹æ ‡ç­¾ï¼š** åŒå‡»å³ä¾§åˆ—è¡¨ä¸­çš„æ ‡æ³¨é¡¹ï¼Œè¾“å…¥æ–°æ ‡ç­¾
- **åˆ é™¤æ ‡æ³¨ï¼š** é€‰ä¸­æ ‡æ³¨ï¼Œç‚¹å‡» **"åˆ é™¤"** æŒ‰é’®
- **æ¸…ç©ºæ‰€æœ‰ï¼š** ç‚¹å‡» **"æ¸…ç©º"** æŒ‰é’®

#### ç¬¬äº”æ­¥ï¼šä¿å­˜æ ‡æ³¨

1. ç‚¹å‡» **"ä¿å­˜ä¸º JSON"** æŒ‰é’®
2. é€‰æ‹©ä¿å­˜ä½ç½®ï¼ˆé»˜è®¤ä¸å›¾åƒåŒç›®å½•åŒåï¼‰
3. ç”Ÿæˆ labelme æ ¼å¼çš„ JSON æ–‡ä»¶

---

## æ‰¹é‡æ ‡æ³¨è„šæœ¬

### æ–¹æ³• 1ï¼šå‘½ä»¤è¡Œæ–¹å¼

```bash
python batch_annotate_sam3.py \
    --model_path ./experiments/checkpoints/model_fp16.pt \
    --folder ./images \
    --prompt car \
    --shape_type polygon \
    --conf_threshold 0.3 \
    --max_objects 10 \
    --label car \
    --device cuda
```

#### å®Œæ•´å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `--model_path` | âœ“ | SAM3 æ¨¡å‹è·¯å¾„ | - |
| `--folder` | âœ“ | å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„ | - |
| `--prompt` | âœ“ | æ–‡æœ¬æç¤ºè¯ï¼ˆå¦‚ "car", "person"ï¼‰ | - |
| `--shape_type` | âœ— | æ ‡æ³¨ç±»å‹ï¼š`polygon`ï¼ˆåˆ†å‰²ï¼‰æˆ– `rectangle`ï¼ˆæ£€æµ‹æ¡†ï¼‰ | `polygon` |
| `--conf_threshold` | âœ— | ç½®ä¿¡åº¦é˜ˆå€¼ | 0.3 |
| `--max_objects` | âœ— | æ¯å¼ å›¾æœ€å¤§æ ‡æ³¨æ•°é‡ | ä¸é™åˆ¶ |
| `--label` | âœ— | æ ‡ç­¾åç§°ï¼ˆé»˜è®¤ä½¿ç”¨æç¤ºè¯ï¼‰ | - |
| `--output_folder` | âœ— | è¾“å‡ºæ–‡ä»¶å¤¹ï¼ˆé»˜è®¤ä¿å­˜åˆ°å›¾ç‰‡åŒç›®å½•ï¼‰ | - |
| `--device` | âœ— | è®¾å¤‡ï¼š`cuda` æˆ– `cpu` | `cuda` |

### æ–¹æ³• 2ï¼šPython è„šæœ¬æ–¹å¼

```python
from batch_annotate_sam3 import BatchAnnotator

# åˆ›å»ºæ ‡æ³¨å™¨
annotator = BatchAnnotator(
    model_path="experiments/checkpoints/model_fp16.pt",
    device="cuda"
)

# æ‰¹é‡å¤„ç†
annotator.process_folder(
    folder_path="./images",
    text_prompt="car",
    shape_type="polygon",  # æˆ– "rectangle"
    conf_threshold=0.3,
    max_objects=10,
    label="car",
    output_folder=None  # None è¡¨ç¤ºä¿å­˜åˆ°å›¾ç‰‡åŒç›®å½•
)
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæ£€æµ‹æ±½è½¦ï¼ˆæ£€æµ‹æ¡†æ¨¡å¼ï¼‰

```bash
python batch_annotate_sam3.py \
    --model_path ./experiments/checkpoints/model_fp16.pt \
    --folder ./images \
    --prompt car \
    --shape_type rectangle \
    --conf_threshold 0.3 \
    --max_objects 5 \
    --label car
```

#### ç¤ºä¾‹ 2ï¼šåˆ†å‰²äººç‰©ï¼ˆå¤šè¾¹å½¢æ¨¡å¼ï¼‰

```bash
python batch_annotate_sam3.py \
    --model_path ./experiments/checkpoints/model_fp16.pt \
    --folder ./images \
    --prompt person \
    --shape_type polygon \
    --conf_threshold 0.5 \
    --max_objects 10 \
    --label person
```

#### ç¤ºä¾‹ 3ï¼šæ£€æµ‹å¤šä¸ªç±»åˆ«

å¦‚æœéœ€è¦æ£€æµ‹å¤šä¸ªç±»åˆ«ï¼Œå¯ä»¥åˆ†åˆ«è¿è¡Œå¤šæ¬¡ï¼š

```bash
# æ£€æµ‹æ±½è½¦
python batch_annotate_sam3.py \
    --model_path ./experiments/checkpoints/model_fp16.pt \
    --folder ./images \
    --prompt car \
    --shape_type rectangle \
    --label car

# æ£€æµ‹äººç‰©
python batch_annotate_sam3.py \
    --model_path ./experiments/checkpoints/model_fp16.pt \
    --folder ./images \
    --prompt person \
    --shape_type rectangle \
    --label person
```

### æ‰¹é‡æ ‡æ³¨å·¥ä½œæµç¨‹

```
1. å‡†å¤‡æ•°æ®
   ./images/
   â”œâ”€â”€ img001.jpg
   â”œâ”€â”€ img002.jpg
   â””â”€â”€ img003.jpg

2. è¿è¡Œæ‰¹é‡æ ‡æ³¨
   python batch_annotate_sam3.py \
       --model_path ./model.pt \
       --folder ./images \
       --prompt car \
       --shape_type polygon

3. ç”Ÿæˆæ ‡æ³¨æ–‡ä»¶ï¼ˆä¿å­˜åˆ°å›¾ç‰‡åŒç›®å½•ï¼‰
   ./images/
   â”œâ”€â”€ img001.jpg
   â”œâ”€â”€ img001.json
   â”œâ”€â”€ img002.jpg
   â”œâ”€â”€ img002.json
   â””â”€â”€ ...

4. ä½¿ç”¨ labelme æŸ¥çœ‹/ç¼–è¾‘
   labelme ./images/
```

---

## æ ‡æ³¨æ ¼å¼è¯´æ˜

### Labelme JSON æ ¼å¼

ç”Ÿæˆçš„ JSON æ–‡ä»¶ä¸ labelme å®Œå…¨å…¼å®¹ï¼š

```json
{
  "version": "5.0.1",
  "flags": {},
  "shapes": [
    {
      "label": "car",
      "points": [
        [123.5, 234.6],
        [125.7, 236.8],
        ...
      ],
      "group_id": null,
      "shape_type": "polygon",
      "flags": {}
    }
  ],
  "imagePath": "image.jpg",
  "imageData": "base64_encoded_string_or_null",
  "imageHeight": 1080,
  "imageWidth": 1920
}
```

### å­—æ®µè¯´æ˜

- **version**: labelme ç‰ˆæœ¬å·
- **shapes**: æ ‡æ³¨å¯¹è±¡åˆ—è¡¨
  - **label**: ç±»åˆ«æ ‡ç­¾
  - **points**: å¤šè¾¹å½¢é¡¶ç‚¹åæ ‡
  - **shape_type**: å½¢çŠ¶ç±»å‹ï¼ˆpolygon æˆ– rectangleï¼‰
- **imagePath**: å›¾åƒæ–‡ä»¶å
- **imageData**: base64 ç¼–ç çš„å›¾åƒæ•°æ®ï¼ˆå¯é€‰ï¼‰
- **imageHeight/imageWidth**: å›¾åƒå°ºå¯¸

---

## é«˜çº§ç”¨æ³•

### 1. ç»„åˆä½¿ç”¨å¤šç§æ ‡æ³¨æ¨¡å¼

```
åœºæ™¯: æ ‡æ³¨ä¸€å¼ åŒ…å«å¤šä¸ªç›®æ ‡çš„å¤æ‚å›¾åƒ

æ­¥éª¤:
1. ä½¿ç”¨æ–‡æœ¬æç¤ºæ£€æµ‹æ‰€æœ‰æ±½è½¦
2. ä½¿ç”¨ç‚¹æç¤ºç²¾ç¡®æ ‡æ³¨è¢«é®æŒ¡çš„è¡Œäºº
3. ä½¿ç”¨æ¡†æç¤ºå¿«é€Ÿæ ‡æ³¨äº¤é€šæ ‡å¿—
4. ç»Ÿä¸€ä¿å­˜ä¸ºä¸€ä¸ª JSON æ–‡ä»¶
```

### 2. è‡ªå®šä¹‰æ ‡ç­¾é¢œè‰²

ç¼–è¾‘ `annotator_config.yaml`:

```yaml
label_colors:
  my_custom_class: [255, 100, 50]  # RGB é¢œè‰²
```

### 3. ç¨‹åºåŒ–æ ‡æ³¨

#### æ–¹æ³• Aï¼šä½¿ç”¨ BatchAnnotator ç±»ï¼ˆæ¨èï¼‰

```python
from batch_annotate_sam3 import BatchAnnotator

# åˆ›å»ºæ ‡æ³¨å™¨ï¼ˆåªéœ€åŠ è½½ä¸€æ¬¡æ¨¡å‹ï¼‰
annotator = BatchAnnotator(
    model_path="./experiments/checkpoints/model_fp16.pt",
    device="cuda"
)

# æ‰¹é‡å¤„ç†æ–‡ä»¶å¤¹
annotator.process_folder(
    folder_path="./images",
    text_prompt="car",
    shape_type="polygon",
    conf_threshold=0.3,
    max_objects=10,
    label="car"
)

# æˆ–å¤„ç†å•å¼ å›¾ç‰‡
labelme_data = annotator.annotate_image(
    image_path="./image.jpg",
    text_prompt="car",
    shape_type="polygon",
    conf_threshold=0.3,
    max_objects=5,
    label="car"
)
```

#### æ–¹æ³• Bï¼šç›´æ¥ä½¿ç”¨ SAM3 API

```python
from sam3.model_builder import build_sam3_image_model
from sam3.model.sam3_image_processor import Sam3Processor
from PIL import Image

# åŠ è½½æ¨¡å‹
model = build_sam3_image_model(
    checkpoint_path="./model.pt",
    load_from_HF=False
)
processor = Sam3Processor(model)

# åŠ è½½å›¾åƒ
image = Image.open("image.jpg")
state = processor.set_image(image)

# æ–‡æœ¬æç¤º
output = processor.set_text_prompt(state=state, prompt="car")
masks, boxes, scores = output["masks"], output["boxes"], output["scores"]

# å¤„ç†ç»“æœ...
```

### 4. ä¸è®­ç»ƒæµç¨‹é›†æˆ

```bash
# 1. æ ‡æ³¨æ•°æ®
python batch_annotate_sam3.py \
    --model_path ./model.pt \
    --folder ./raw_images \
    --prompt target_class \
    --shape_type polygon

# 2. è½¬æ¢æ ¼å¼ï¼ˆå¦‚éœ€è¦ï¼‰
python labelme_to_coco.py --input ./annotations --output ./coco_format

# 3. è®­ç»ƒæ¨¡å‹
python sam3/train/train.py --config ./train_config.yaml
```

---

## å¸¸è§é—®é¢˜

### Q1: æ¨¡å‹åŠ è½½å¤±è´¥

**é—®é¢˜ï¼š** ç‚¹å‡»"åŠ è½½æ¨¡å‹"åå‡ºé”™

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥æ¨¡å‹æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æ¨¡å‹æ–‡ä»¶å®Œæ•´ï¼ˆå¤§å°çº¦ 170MBï¼‰
- æ£€æŸ¥ PyTorch ç‰ˆæœ¬æ˜¯å¦å…¼å®¹

### Q2: æ£€æµ‹ç»“æœä¸å‡†ç¡®

**é—®é¢˜ï¼š** æ–‡æœ¬æç¤ºæ£€æµ‹åˆ°é”™è¯¯çš„ç›®æ ‡

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨æ›´å…·ä½“çš„ç±»åˆ«åç§°ï¼ˆå¦‚ "sedan car" è€Œä¸æ˜¯ "car"ï¼‰
- è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆæé«˜ä»¥å‡å°‘è¯¯æ£€ï¼‰
- æ”¹ç”¨ç‚¹æç¤ºæˆ–æ¡†æç¤ºæ¨¡å¼æ‰‹åŠ¨æ ‡æ³¨

### Q3: æ ‡æ³¨è¾¹ç•Œä¸å‡†ç¡®

**é—®é¢˜ï¼š** ç”Ÿæˆçš„ mask è¾¹ç•Œä¸å¤Ÿç²¾ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ç‚¹æç¤ºæ¨¡å¼ï¼Œæ·»åŠ æ›´å¤šå‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹
- åœ¨ç›®æ ‡è¾¹ç¼˜æ·»åŠ ç‚¹ä»¥è·å¾—æ›´ç²¾ç¡®çš„è¾¹ç•Œ
- è°ƒæ•´ `annotator_config.yaml` ä¸­çš„ `polygon_tolerance` å‚æ•°

### Q4: JSON æ–‡ä»¶è¿‡å¤§

**é—®é¢˜ï¼š** ç”Ÿæˆçš„ JSON æ–‡ä»¶å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´

**è§£å†³æ–¹æ¡ˆï¼š**
- é»˜è®¤ä¸ä¿å­˜å›¾åƒæ•°æ®ï¼ˆ`imageData` ä¸º `null`ï¼‰ï¼Œå·²å‡å°æ–‡ä»¶å¤§å°
- ä½¿ç”¨ `--max_objects` é™åˆ¶æ¯å¼ å›¾çš„æ ‡æ³¨æ•°é‡
- ä½¿ç”¨æ›´é«˜çš„ç½®ä¿¡åº¦é˜ˆå€¼å‡å°‘æ ‡æ³¨æ•°é‡

### Q5: æ‰¹é‡æ ‡æ³¨é€Ÿåº¦æ…¢

**é—®é¢˜ï¼š** å¤„ç†å¤§é‡å›¾åƒæ—¶é€Ÿåº¦å¾ˆæ…¢

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ GPU åŠ é€Ÿï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰
- å‡å°‘ prompts æ•°é‡
- æé«˜ç½®ä¿¡åº¦é˜ˆå€¼
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆå¦‚æœå¯ç”¨ï¼‰

### Q6: å¦‚ä½•ç¼–è¾‘å·²æœ‰æ ‡æ³¨

**é—®é¢˜ï¼š** éœ€è¦ä¿®æ”¹ä¹‹å‰ä¿å­˜çš„æ ‡æ³¨

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ–¹æ³•1: ä½¿ç”¨ GUI å·¥å…·
python sam3_annotator.py
# ç‚¹å‡»"åŠ è½½ JSON"ï¼Œä¿®æ”¹åé‡æ–°ä¿å­˜

# æ–¹æ³•2: ä½¿ç”¨ labelme
labelme annotation.json

# æ–¹æ³•3: ç›´æ¥ç¼–è¾‘ JSON æ–‡ä»¶
```

### Q7: ä¸å…¶ä»–æ ‡æ³¨æ ¼å¼è½¬æ¢

**é—®é¢˜ï¼š** éœ€è¦ COCOã€YOLO ç­‰æ ¼å¼

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# Labelme è‡ªå¸¦è½¬æ¢å·¥å…·
labelme_json_to_dataset annotation.json

# æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¬æ¢è„šæœ¬
# https://github.com/wkentaro/labelme
```

---

## æŠ€å·§å’Œæœ€ä½³å®è·µ

### æ ‡æ³¨æŠ€å·§

1. **æ–‡æœ¬æç¤ºé€‰æ‹©**
   - âœ“ å¥½: "car", "person", "dog"
   - âœ— å·®: "vehicles", "things", "stuff"

2. **ç‚¹æç¤ºç­–ç•¥**
   - å…ˆæ·»åŠ ç›®æ ‡ä¸­å¿ƒçš„å‰æ™¯ç‚¹
   - åœ¨ç›®æ ‡è¾¹ç¼˜æ·»åŠ æ›´å¤šå‰æ™¯ç‚¹
   - åœ¨é‚»è¿‘å¹²æ‰°ç‰©ä¸Šæ·»åŠ èƒŒæ™¯ç‚¹

3. **ç½®ä¿¡åº¦é˜ˆå€¼**
   - ç²¾ç¡®æ ‡æ³¨: 0.4-0.6
   - å¬å›ä¼˜å…ˆ: 0.2-0.3
   - å‡†ç¡®ä¼˜å…ˆ: 0.5-0.7

### å·¥ä½œæµç¨‹å»ºè®®

```
æ•°æ®å‡†å¤‡ â†’ æ‰¹é‡è‡ªåŠ¨æ ‡æ³¨ â†’ GUI å·¥å…·å¾®è°ƒ â†’ è´¨é‡æ£€æŸ¥ â†’ å¯¼å‡ºä½¿ç”¨
   â†“            â†“              â†“            â†“          â†“
 æ•´ç†å›¾åƒ   batch_annotate  sam3_annotator  labelme   è®­ç»ƒæ¨¡å‹
```

### è´¨é‡æ§åˆ¶

1. **éšæœºæŠ½æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æ ‡æ³¨è´¨é‡
2. **è¾¹ç•Œæ£€æŸ¥**ï¼šç¡®ä¿ mask è¾¹ç•Œå‡†ç¡®
3. **ç±»åˆ«ä¸€è‡´**ï¼šä¿æŒæ ‡ç­¾å‘½åç»Ÿä¸€
4. **è¦†ç›–å®Œæ•´**ï¼šç¡®ä¿æ‰€æœ‰ç›®æ ‡éƒ½è¢«æ ‡æ³¨

---

## æ€»ç»“

SAM3 æ ‡æ³¨å·¥å…·æä¾›äº†ï¼š

- ğŸ¨ **ç›´è§‚çš„ GUI ç•Œé¢** - ç±»ä¼¼ labelme çš„æ“ä½œä½“éªŒ
- ğŸ¤– **AI è¾…åŠ©æ ‡æ³¨** - å¤§å¹…æå‡æ ‡æ³¨æ•ˆç‡
- ğŸ“¦ **æ‰¹é‡å¤„ç†èƒ½åŠ›** - æ”¯æŒå¤§è§„æ¨¡æ•°æ®æ ‡æ³¨
- ğŸ”„ **æ ¼å¼å…¼å®¹æ€§** - å®Œå…¨å…¼å®¹ labelme æ ¼å¼
- âœï¸ **çµæ´»çš„ç¼–è¾‘** - æ”¯æŒæ ‡æ³¨å¾®è°ƒ

**å¼€å§‹ä½¿ç”¨ï¼š**
```bash
python sam3_annotator.py
```

**æ‰¹é‡æ ‡æ³¨ï¼š**
```bash
python batch_annotate_sam3.py \
    --model_path ./model.pt \
    --folder ./images \
    --prompt car \
    --shape_type polygon
```

ç¥æ ‡æ³¨æ„‰å¿«ï¼ ğŸš€

